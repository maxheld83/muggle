<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Deploy a shiny app to Microsoft Azure Web Apps for Containers — az_webapp_config_muggle • muggle</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>

<!-- ugoe -->
<link href="../ugoe_bootswatch.css" rel="stylesheet">


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Deploy a shiny app to Microsoft Azure Web Apps for Containers — az_webapp_config_muggle" />
<meta property="og:description" content="Wraps the Azure Command-Line Interface (CLI) with defaults suitable for deploying a shiny app." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://matomo.gwdg.de/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '407']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">muggle</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2-20211125</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Background</li>
    <li>
      <a href="../articles/motivation.html">Bridging the Unproductive Valley</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Process</li>
    <li>
      <a href="../articles/communicating.html">Communicating</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../articles/index.html">More...</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/subugoe/muggle/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Deploy a shiny app to <a href='https://azure.microsoft.com/en-us/services/app-service/containers/'>Microsoft Azure Web Apps for Containers</a></h1>
    <small class="dont-index">Source: <a href='https://github.com/subugoe/muggle/blob/master/R/deployment.R'><code>R/deployment.R</code></a></small>
    <div class="hidden name"><code>az_webapp_config_muggle.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Wraps the <a href='https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest'>Azure Command-Line Interface (CLI)</a> with defaults suitable for deploying a shiny app.</p>
    </div>

    <pre class="usage"><span class='fu'>az_webapp_config_muggle</span><span class='op'>(</span>
  name <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span><span class='op'>(</span><span class='st'>"MUGGLE_PKG_NAME"</span><span class='op'>)</span>,
  <span class='va'>plan</span>,
  <span class='va'>resource_group</span>,
  <span class='va'>subscription</span>,
  docker_registry_server_user <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span><span class='op'>(</span><span class='st'>"GITHUB_ACTOR"</span><span class='op'>)</span>,
  docker_registry_server_password <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span><span class='op'>(</span><span class='st'>"GITHUB_TOKEN"</span><span class='op'>)</span>,
  restart <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>name</th>
      <td><p>Name of the web app.</p></td>
    </tr>
    <tr>
      <th>plan</th>
      <td><p>Name or resource id of the app service plan.</p></td>
    </tr>
    <tr>
      <th>resource_group</th>
      <td><p>The <a href='https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal'>Azure resource group</a> to which the shiny app should belong.</p></td>
    </tr>
    <tr>
      <th>subscription</th>
      <td><p>Name or ID of the Azure subscription to which costs are billed.
According to an upvoted answer on Stack Overflow, <a href='https://stackoverflow.com/questions/45661109/are-azure-subscription-id-aad-tenant-id-and-aad-app-client-id-considered-secre'>Azure subscription IDs need not be considered a secret or personal identifiable information (PII)</a>.
However, depending your applicable context and policies, you may want to provide this argument as a secret.</p></td>
    </tr>
    <tr>
      <th>docker_registry_server_user</th>
      <td><p>Credentials for private container registries.
Defaults to <code>NULL</code> for public registries.
Do not expose your credentials in public code; it's best to use secret environment variables.</p></td>
    </tr>
    <tr>
      <th>docker_registry_server_password</th>
      <td><p>Credentials for private container registries.
Defaults to <code>NULL</code> for public registries.
Do not expose your credentials in public code; it's best to use secret environment variables.</p></td>
    </tr>
    <tr>
      <th>restart</th>
      <td><p>whether to restart the web app.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Wrapping with muggle defaults; use only inside muggle projects.</p>
    <h2 class="hasAnchor" id="authenticating-against-github-packages"><a class="anchor" href="#authenticating-against-github-packages"></a>Authenticating Against GitHub Packages</h2>

    <p>Because muggle stores the docker images with the shiny runtimes on
GitHub Packages, Azure must pull images from there,
not the commonly used Docker Hub.</p>
<p>Currently, GitHub Packages does not offer public images,
even for public repositories
(<a href='https://github.com/subugoe/muggle/issues/133'>#133</a>)
That means that Azure must be
<a href='https://docs.github.com/en/packages/using-github-packages-with-your-projects-ecosystem/configuring-docker-for-use-with-github-packages'>authenticated</a>
to be able to download the runtime images.
This is the inverse of the the <code>azure login</code> GitHub Action,
which authenticates the GitHub Actions runtime to talk to Azure.</p>
<p>There are (only) two ways to do this,
both suboptimal (<a href='https://github.com/subugoe/muggle/issues/132'>#132</a>):</p><ol>
<li><p>You can authenticate Azure with a
<a href='https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token'>personal access token (PAT)</a>
and the corresponding <strong>static GitHub username</strong>.
No matter who commits and triggered the deployment,
always the same personal GitHub credentials
(say, those of Jane Doe) will be used.
To do this, the volunteering team member should create a PAT on GitHub,
scope it minimally to only read packages,
and paste that into the Azure web ui at portal.azure.com.
A minimally scoped PAT may be reasonably safe,
but the approach is still cumbersome and awkward.</p></li>
<li><p>You can authenticate Azure towards GitHub Packages
<strong>with the <code>GITHUB_ACTOR</code> and <code>GITHUB_TOKEN</code> pair</strong>
<a href='https://docs.github.com/en/actions/configuring-and-managing-workflows/authenticating-with-the-github_token'>furnished</a>
for GitHub Actions, from which the deployment takes place.
The <code>GITHUB_ACTOR</code> environment variable will always be
the GitHub username of whoever triggered the workflow run,
and therefore, the deployment.
The <code>GITHUB_TOKEN</code> is a PAT scoped to <em>only</em> that repo and will expire
automatically after the workflow run is completed.
To use this authentication, use the below defaults and expose the
<code>GITHUB_TOKEN</code> to in your workflow <code>*.yaml</code> file.<div class="yaml"></p><pre>env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
</pre><p></div></p>
<p>This is a more elegant, and arguably more secure solution,
though the <code>GITHUB_TOKEN</code> still has more scope than just to read packages,
if only for the repo in question.
This form of authentication seems to work reliably,
but may break future app (re)starts on Azure:
Should Azure loose the docker cache of the image in question,
it will not be able to <code>docker pull</code> the image again,
because the <code>GITHUB_TOKEN</code> will have expired by then.
Only a new workflow run can heal the app in this scenario.
It remains to be seen how common this problem is.</p></li>
</ol>

    <h2 class="hasAnchor" id="functions"><a class="anchor" href="#functions"></a>Functions</h2>

    

<ul>
<li><p><code>az_webapp_shiny_opts</code>: Set shiny options as <a href='https://docs.microsoft.com/en-us/azure/app-service/containers/configure-custom-container'>required for an Azure Webapp</a>:</p><ul>
<li><p><code>options(shiny.port = as.integer(Sys.getenv('PORT'))</code>.
Your custom container is expected to listen on <code>PORT</code>, an environment variable set by Azure.
If your image suggests <code>EXPOSE</code>d ports, that may be respected by Azure (undocumented behavior).</p></li>
<li><p><code>options(shiny.host = "0.0.0.0")</code> to make your shiny application accessable to the Azure Webapp hosting environment.</p></li>
</ul>

<p>You can also set these options manually as in the below example.</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='cn'>NULL</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> NULL</span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="contents col-md-9">
  <p>Developed by <a href='https://www.maxheld.de'>Maximilian Held</a>, <a href='https://www.sub.uni-goettingen.de/'>Göttingen State and University Library</a>.</p>
  <p>
    <a href="https://www.sub.uni-goettingen.de/en/imprint/data-privacy-statement/">Privacy Statement</a>
    and
    <a href="https://www.sub.uni-goettingen.de/impressum/">Imprint</a>
    apply.
  </p>
</div>

<div class="col-md-3 hidden-xs hidden-sm">
  <p>
    <a href="https://www.sub.uni-goettingen.de/"><img src="https://subugoe.github.io/subugoetheme/sub_wordmark.jpg" height="17"></a>
  </p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '6210bf760111eb2d7173ad99203499e2',
    indexName: 'subugoe_muggle',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


